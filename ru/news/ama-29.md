# Sub Dev Sharing | Обновление и разделение среды выполнения субстрата

### Введение

В прошлое воскресенье вечером основной разработчик Bifrost, Джейми Денг, прочитал в зале прямых трансляций первую лекцию на тему «Обновление и разделение среды выполнения субстрата». Демо-адрес находится здесь: https://github.com/Dengjianping/816/tree/jamie816/demo

***Дата: 16.08.2020***

### Поделиться отзывом

**Обновление среды выполнения, почему веб-сборка**

Прежде всего, Substrate создается с использованием Rust и веб-сборки, а написанная среда выполнения будет скомпилирована в файл wasm, а сгенерированные WAM-файлы могут быть выполнены на виртуальной машине для достижения безветвкового обновления.

Во-вторых, веб-сборка имеет много преимуществ.

- высокая производительность. Когда скомпилированный wasm выполняется, инструкции выполнения близки к базовому оборудованию и все выполняются быстро.
- Песочница.Веб-сборка выполняется на виртуальной машине, поэтому можно проводить изоляцию и термообработку.
- Хорошая поддержка сообщества. Цепочка инструментов и экология получили сильную поддержку со стороны сообщества. Например, в настоящее время rust лучше всего поддерживает webassem. Есть и другие преимущества, такие как кроссплатформенность, лучшая безопасность и т. Д.

**Зачем нужны обновления среды выполнения при разработке субстратов**

- безопасность.Когда проблема безопасности обнаруживается в коде в цепочке, для своевременного устранения проблемы очень необходимо обновить среду выполнения онлайн.
- Добавьте новые интерфейсы или функции.
- спектакль.Когда мы оптимизируем производительность модуля Runtime, необходимо обновить Runtime.

Некоторые правила обновления среды выполнения Перехватить последний код времени выполнения, связанный с RC5.

`/// Runtime version.pub const VERSION: RuntimeVersion = RuntimeVersion {    spec_name: create_runtime_str!("node"),    impl_name: create_runtime_str!("substrate-node"),    authoring_version: 10,    // Per convention: if the runtime behavior changes, increment spec_version    // and set impl_version to 0. If only runtime    // implementation changes and behavior does not, then leave spec_version as    // is and increment impl_version.    spec_version: 256,    impl_version: 0,    apis: RUNTIME_API_VERSIONS,    transaction_version: 1,};`

Здесь есть два поля, связанных с обновлением среды выполнения:

- spec_version.Например, при добавлении или удалении нового интерфейса, что приводит к логическому изменению консенсуса среды выполнения, требуется +1.При обновлении spec_version новой версии Runtime выше, чем spec_version текущей запущенной версии, тогда цепочка будет обновлена ​​до последней Runtime.
- impl_version.Это скорее модификация неконсенсусных изменений логики, таких как оптимизация производительности интерфейса. Если оптимизация не удалась, выходные данные этого интерфейса изменится.
- Объяснение остальных полей можно прочитать в этой статье Runtime Execution.

**Примеры**

Пример кода скомпилирован отсюда:

https://github.com/Dengjianping/816/tree/jamie816，

Скомпилируйте весь проект, желательно в режиме релиза. Текущий пример содержит модуль Token с двумя интерфейсами issue & amp; & amp; destroy. Эти два интерфейса могут выпускать и уничтожать токены соответственно, и ими могут управлять только пользователи с разрешениями sudo.

1. Измените spec_version на 256, скомпилируйте и сгенерируйте собственный узел, который содержит только интерфейс задачи.Прокомментируйте строку 45 - строку 89, а затем скомпилируйте проект.

`Cargo build --releasecp target / release / subsubture. # Скопировать текущий скомпилированный собственный двоичный файл в текущий каталог, чтобы избежать перезаписи при следующей компиляции`

2. Измените spec_version на 257, скомпилируйте проект, чтобы сгенерировать wasm-файл, содержащий интерфейсы проблемы и уничтожения, удалите комментарии из строки 45 по строку 89, а затем скомпилируйте проект.

`# Создать путь wasm: target / release / wbuild / node-runtime / node_runtime.compact.wasmcargo build --release`

3. Обновить, запустить узел

`./substrate --dev`

Посетите интерфейсный инструмент polkadot.js.org и обнаружите, что интерфейсная страница не может загрузить данные узла. Скопируйте тип данных types.json в часть, отображающую снимок экрана. После сохранения обновите страницу.





















